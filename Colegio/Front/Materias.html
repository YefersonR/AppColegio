<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <h1>Materia</h1>
    
    <form id="agregar">
        <input type="hidden" value="" name="Id" Id="Id">
        
        <label>IdCurso:</label>
        <input type="text" name="idcurso" id="idcurso">
        <br>
        <label>Profesor:</label>
        <input type="text" name="profesor" id="profesor">
        <br>
        <label>Nombre Materia:</label>
        <input type="text" name="materia" id="materia">
        <br>
        <label>Horario:</label>
        <input type="text" name="horario" id="horario">
        
        <br>
        <input type="button" value="Guardar" onclick="Guardar();">
    </form>

    <hr>
    <div id = "ListaMaterias"></div>
</body>
</html>

<script>
var urlmateria = "https://localhost:44356/api/materia";

Get();


function Get(){
        fetch(urlmateria).then(function(response){
            return response.json();
        }).then(function(Data){
        document.getElementById("ListaMaterias").innerHTML="";
        for(i=0;i<Data.length;i++){
            let divElement = document.createElement("div");
            let divSpan = document.createElement("span");
            let divButtonEditar = document.createElement("button");
            let divButtonEliminar = document.createElement("button");
            
            divElement.innerHTML =Data[i].idmaterias+"-"+Data[i].idcurso+"-"+Data[i].profesor+"-"+Data[i].nombreMateria+"-"+Data[i].horario;
            divButtonEliminar.innerHTML = "Eliminar";
            divButtonEditar.innerHTML = "Editar";
            divButtonEliminar.miidmateria=Data[i].idmaterias;
            divButtonEliminar.addEventListener("click",function(boton){
                Eliminar(boton.target.miidmateria);
            })
            divButtonEditar.miidcurso=Data[i].idcurso;
            divButtonEditar.miprofesor=Data[i].profesor;
            divButtonEditar.minombrema=Data[i].nombreMateria;
            divButtonEditar.mihorario=Data[i].horario;
            
            divButtonEditar.addEventListener("click",function(boton){
                Editar(
                    boton.target.miidcurso,
                    boton.target.miprofesor,
                    boton.target.minombrema,
                    boton.target.mihorario                 
                    );
            })
            divElement.appendChild(divSpan);
            divElement.appendChild(divButtonEliminar)
            divElement.appendChild(divButtonEditar)
            document.getElementById("ListaMaterias").appendChild(divElement);
        }})
}


function Guardar(){
    if(document.getElementById("Id").value!=""){
        modificar();
    }else{
        Post();
    }
}
function Post(){
    fetch(urlmateria, {
        method:"POST",
        body:JSON.stringify({
            idcurso:document.getElementById("idcurso").value,
            profesor:document.getElementById("profesor").value,
            nombreMateria:document.getElementById("materia").value,
            horario:document.getElementById("horario").value,
        }),
        headers:{
            'Accept':"application/json",
            "Content-Type":"application/json"
        }
    }).then(function(response){
        if (response.ok){
            return response.text();
        }else{
            alert("Error al ejecutar solicitud");
        }
    }).then(function(Data){
        console.log(Data);
        Get();  
        document.getElementById("idcurso").value="",
        document.getElementById("profesor").value="",
        document.getElementById("materia").value="",
        document.getElementById("horario").value=""

    })
}

function Eliminar(idmaterias){
    fetch(urlmateria, {
        method:"DELETE",
        body:JSON.stringify({
            idmaterias:idmaterias,
        }),
        headers:{
            'Accept':"application/json",
            "Content-Type":"application/json"
        }
    }).then(function(response){
        if (response.ok){
            return response.text();
        }else{
            alert("Error al ejecutar solicitud");
        }
    }).then(function(Data){
        console.log(Data);
        Get();
    })
}
function Editar(idcurso,profesor,nombreMateria,horario){
document.getElementById("idcurso").value=idcurso;
document.getElementById("profesor").value=profesor;
document.getElementById("materia").value=nombreMateria;
document.getElementById("horario").value=horario;
}
function modificar(){
    fetch(urlcurso, {
        method:"PUT",
        body:JSON.stringify({
            idmaterias:document.getElementById("idmateria").value,
            idcurso:document.getElementById("idcurso").value,
            profesor:document.getElementById("profesor").value,
            nombreMateria:document.getElementById("nombreMateria").value,
            horario:document.getElementById("horario").value,        }),
        headers:{
            'Accept':"application/json",
            "Content-Type":"application/json"        
        }
    }).then(function(response){
        if (response.ok){
            return response.text();
        }else{
            alert("Error al ejecutar solicitud");
        }
    }).then(function(Data){
        console.log(Data);
        Get();
        document.getElementById("idcurso").value="",
        document.getElementById("profesor").value="",
        document.getElementById("nombreMateria").value="",
        document.getElementById("horario").value=""

    })

}

</script>

<style type="diseÃ±o/ccs">

</style>